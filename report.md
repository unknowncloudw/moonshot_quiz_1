# 题⽬1：维基百科数据清洗

github链接: https://github.com/unknowncloudw/moonshot_quiz_1

## 清洗策略

经观察发现，wikipedia的xml文件里面需要处理的结构应当包括以下几类：

1. XML注释。以`<!--`开头，以`-->`结尾。

2. XML表格。以`{|`开头，以`|}`结尾。

3. XML链接。以`[[`开头，以`]]`结尾。

4. XML模板。以`{{`开头，以`}}`结尾。

其中，注释的内容几乎全部无用。表格的内容大部分无用小部分有用，但为了尽可能地保证数据质量，我们选择全部去除。

XML链接和XML模板的情况比较复杂。我们为这两种情况单独编写了函数进行处理，具体方法见下节。

除了这四种结构之外，我们也去掉标题和处理后过短的文本行。



## 遇到的问题

维基百科的XML数据比较脏，以下是处理过程中遇到的一些问题：

### 1. XML链接和XML模板存在嵌套现象，简单地使用正则表达式无法处理

结合上文提到的XML链接和XML模板的情况，我们为XML链接和XML模板各自单独编写函数进行处理。

### 2. XML链接和XML模板存在多种使用情况

对数据进行观察发现，XML链接和XML模板都有多种使用情况。常见的Wikipedia xml处理包，如Wikipedia Extractor，并没有对情况进行区分，影响了清洗效果。

观察发现，XML链接有两种使用情况，一种嵌在正文内部（指向另一个条目），如果去除会影响文本连贯性；另一种是正文外部的图片、文件等，可以去除。
分辨两种情况的方法是，如果链接以`[[File`,`[[Image`,`[[Category`,`[[Wikipedia`开头，那么属于正文外部的链接，可以去除；否则属于嵌入在正文内部的链接，不应去除。

XML模板的情况和XML链接类似。只有正文内部代表其他语言文本的模板（以`{{Lang`或`{{lang`开头）才应保留，其他的全部应该去除。

可能还有其他未观察到的情况，待后续补充。

